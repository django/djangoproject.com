{"parents": [{"link": "../../../../", "title": "Module code"}, {"link": "../../../", "title": "django"}, {"link": "../", "title": "django.core.mail"}], "title": "django.core.mail.message", "body": "<h1>Source code for django.core.mail.message</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">mimetypes</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email</span> <span class=\"kn\">import</span> <span class=\"n\">charset</span> <span class=\"k\">as</span> <span class=\"n\">Charset</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email</span> <span class=\"kn\">import</span> <span class=\"n\">encoders</span> <span class=\"k\">as</span> <span class=\"n\">Encoders</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email</span> <span class=\"kn\">import</span> <span class=\"n\">generator</span><span class=\"p\">,</span> <span class=\"n\">message_from_string</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.errors</span> <span class=\"kn\">import</span> <span class=\"n\">HeaderParseError</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.header</span> <span class=\"kn\">import</span> <span class=\"n\">Header</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.headerregistry</span> <span class=\"kn\">import</span> <span class=\"n\">Address</span><span class=\"p\">,</span> <span class=\"n\">parser</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.message</span> <span class=\"kn\">import</span> <span class=\"n\">Message</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.mime.base</span> <span class=\"kn\">import</span> <span class=\"n\">MIMEBase</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.mime.message</span> <span class=\"kn\">import</span> <span class=\"n\">MIMEMessage</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.mime.multipart</span> <span class=\"kn\">import</span> <span class=\"n\">MIMEMultipart</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.mime.text</span> <span class=\"kn\">import</span> <span class=\"n\">MIMEText</span>\n<span class=\"kn\">from</span> <span class=\"nn\">email.utils</span> <span class=\"kn\">import</span> <span class=\"n\">formataddr</span><span class=\"p\">,</span> <span class=\"n\">formatdate</span><span class=\"p\">,</span> <span class=\"n\">getaddresses</span><span class=\"p\">,</span> <span class=\"n\">make_msgid</span>\n<span class=\"kn\">from</span> <span class=\"nn\">io</span> <span class=\"kn\">import</span> <span class=\"n\">BytesIO</span><span class=\"p\">,</span> <span class=\"n\">StringIO</span>\n<span class=\"kn\">from</span> <span class=\"nn\">pathlib</span> <span class=\"kn\">import</span> <span class=\"n\">Path</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django.conf</span> <span class=\"kn\">import</span> <span class=\"n\">settings</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.mail.utils</span> <span class=\"kn\">import</span> <span class=\"n\">DNS_NAME</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.encoding</span> <span class=\"kn\">import</span> <span class=\"n\">force_str</span><span class=\"p\">,</span> <span class=\"n\">punycode</span>\n\n<span class=\"c1\"># Don&#39;t BASE64-encode UTF-8 messages so that we avoid unwanted attention from</span>\n<span class=\"c1\"># some spam filters.</span>\n<span class=\"n\">utf8_charset</span> <span class=\"o\">=</span> <span class=\"n\">Charset</span><span class=\"o\">.</span><span class=\"n\">Charset</span><span class=\"p\">(</span><span class=\"s2\">&quot;utf-8&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">utf8_charset</span><span class=\"o\">.</span><span class=\"n\">body_encoding</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>  <span class=\"c1\"># Python defaults to BASE64</span>\n<span class=\"n\">utf8_charset_qp</span> <span class=\"o\">=</span> <span class=\"n\">Charset</span><span class=\"o\">.</span><span class=\"n\">Charset</span><span class=\"p\">(</span><span class=\"s2\">&quot;utf-8&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">utf8_charset_qp</span><span class=\"o\">.</span><span class=\"n\">body_encoding</span> <span class=\"o\">=</span> <span class=\"n\">Charset</span><span class=\"o\">.</span><span class=\"n\">QP</span>\n\n<span class=\"c1\"># Default MIME type to use on attachments (if it is not explicitly given</span>\n<span class=\"c1\"># and cannot be guessed).</span>\n<span class=\"n\">DEFAULT_ATTACHMENT_MIME_TYPE</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;application/octet-stream&quot;</span>\n\n<span class=\"n\">RFC5322_EMAIL_LINE_LENGTH_LIMIT</span> <span class=\"o\">=</span> <span class=\"mi\">998</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">BadHeaderError</span><span class=\"p\">(</span><span class=\"ne\">ValueError</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<span class=\"c1\"># Header names that contain structured address data (RFC 5322).</span>\n<span class=\"n\">ADDRESS_HEADERS</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&quot;from&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;sender&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;reply-to&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;to&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;cc&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;bcc&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;resent-from&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;resent-sender&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;resent-to&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;resent-cc&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;resent-bcc&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">forbid_multi_line_headers</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Forbid multi-line headers to prevent header injection.&quot;&quot;&quot;</span>\n    <span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"n\">encoding</span> <span class=\"ow\">or</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_CHARSET</span>\n    <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">)</span>  <span class=\"c1\"># val may be lazy</span>\n    <span class=\"k\">if</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">val</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\r</span><span class=\"s2\">&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">val</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">BadHeaderError</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;Header values can&#39;t contain newlines (got </span><span class=\"si\">%r</span><span class=\"s2\"> for header </span><span class=\"si\">%r</span><span class=\"s2\">)&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">val</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s2\">&quot;ascii&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"ne\">UnicodeEncodeError</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span> <span class=\"ow\">in</span> <span class=\"n\">ADDRESS_HEADERS</span><span class=\"p\">:</span>\n            <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span>\n                <span class=\"n\">sanitize_address</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">addr</span> <span class=\"ow\">in</span> <span class=\"n\">getaddresses</span><span class=\"p\">((</span><span class=\"n\">val</span><span class=\"p\">,))</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"n\">Header</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">()</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;subject&quot;</span><span class=\"p\">:</span>\n            <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"n\">Header</span><span class=\"p\">(</span><span class=\"n\">val</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">()</span>\n    <span class=\"k\">return</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">sanitize_address</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Format a pair of (name, address) or an email address string.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">address</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">,</span> <span class=\"nb\">tuple</span><span class=\"p\">):</span>\n        <span class=\"n\">addr</span> <span class=\"o\">=</span> <span class=\"n\">force_str</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">)</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">token</span><span class=\"p\">,</span> <span class=\"n\">rest</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">get_mailbox</span><span class=\"p\">(</span><span class=\"n\">addr</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"n\">HeaderParseError</span><span class=\"p\">,</span> <span class=\"ne\">ValueError</span><span class=\"p\">,</span> <span class=\"ne\">IndexError</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s1\">&#39;Invalid address &quot;</span><span class=\"si\">%s</span><span class=\"s1\">&quot;&#39;</span> <span class=\"o\">%</span> <span class=\"n\">addr</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">rest</span><span class=\"p\">:</span>\n                <span class=\"c1\"># The entire email address must be parsed.</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                    <span class=\"s1\">&#39;Invalid address; only </span><span class=\"si\">%s</span><span class=\"s1\"> could be parsed from &quot;</span><span class=\"si\">%s</span><span class=\"s1\">&quot;&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">token</span><span class=\"p\">,</span> <span class=\"n\">addr</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n            <span class=\"n\">nm</span> <span class=\"o\">=</span> <span class=\"n\">token</span><span class=\"o\">.</span><span class=\"n\">display_name</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;&quot;</span>\n            <span class=\"n\">localpart</span> <span class=\"o\">=</span> <span class=\"n\">token</span><span class=\"o\">.</span><span class=\"n\">local_part</span>\n            <span class=\"n\">domain</span> <span class=\"o\">=</span> <span class=\"n\">token</span><span class=\"o\">.</span><span class=\"n\">domain</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;&quot;</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">nm</span><span class=\"p\">,</span> <span class=\"n\">address</span> <span class=\"o\">=</span> <span class=\"n\">addr</span>\n        <span class=\"n\">localpart</span><span class=\"p\">,</span> <span class=\"n\">domain</span> <span class=\"o\">=</span> <span class=\"n\">address</span><span class=\"o\">.</span><span class=\"n\">rsplit</span><span class=\"p\">(</span><span class=\"s2\">&quot;@&quot;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n\n    <span class=\"n\">address_parts</span> <span class=\"o\">=</span> <span class=\"n\">nm</span> <span class=\"o\">+</span> <span class=\"n\">localpart</span> <span class=\"o\">+</span> <span class=\"n\">domain</span>\n    <span class=\"k\">if</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">address_parts</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;</span><span class=\"se\">\\r</span><span class=\"s2\">&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">address_parts</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">&quot;Invalid address; address parts cannot contain newlines.&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Avoid UTF-8 encode, if it&#39;s possible.</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">nm</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s2\">&quot;ascii&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">nm</span> <span class=\"o\">=</span> <span class=\"n\">Header</span><span class=\"p\">(</span><span class=\"n\">nm</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">()</span>\n    <span class=\"k\">except</span> <span class=\"ne\">UnicodeEncodeError</span><span class=\"p\">:</span>\n        <span class=\"n\">nm</span> <span class=\"o\">=</span> <span class=\"n\">Header</span><span class=\"p\">(</span><span class=\"n\">nm</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">()</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">localpart</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s2\">&quot;ascii&quot;</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"ne\">UnicodeEncodeError</span><span class=\"p\">:</span>\n        <span class=\"n\">localpart</span> <span class=\"o\">=</span> <span class=\"n\">Header</span><span class=\"p\">(</span><span class=\"n\">localpart</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">()</span>\n    <span class=\"n\">domain</span> <span class=\"o\">=</span> <span class=\"n\">punycode</span><span class=\"p\">(</span><span class=\"n\">domain</span><span class=\"p\">)</span>\n\n    <span class=\"n\">parsed_address</span> <span class=\"o\">=</span> <span class=\"n\">Address</span><span class=\"p\">(</span><span class=\"n\">username</span><span class=\"o\">=</span><span class=\"n\">localpart</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"n\">domain</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">formataddr</span><span class=\"p\">((</span><span class=\"n\">nm</span><span class=\"p\">,</span> <span class=\"n\">parsed_address</span><span class=\"o\">.</span><span class=\"n\">addr_spec</span><span class=\"p\">))</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">MIMEMixin</span><span class=\"p\">:</span>\n    <span class=\"k\">def</span> <span class=\"nf\">as_string</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">unixfrom</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">linesep</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Return the entire formatted message as a string.</span>\n<span class=\"sd\">        Optional `unixfrom&#39; when True, means include the Unix From_ envelope</span>\n<span class=\"sd\">        header.</span>\n\n<span class=\"sd\">        This overrides the default as_string() implementation to not mangle</span>\n<span class=\"sd\">        lines that begin with &#39;From &#39;. See bug #13433 for details.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">fp</span> <span class=\"o\">=</span> <span class=\"n\">StringIO</span><span class=\"p\">()</span>\n        <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">generator</span><span class=\"o\">.</span><span class=\"n\">Generator</span><span class=\"p\">(</span><span class=\"n\">fp</span><span class=\"p\">,</span> <span class=\"n\">mangle_from_</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">flatten</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">unixfrom</span><span class=\"o\">=</span><span class=\"n\">unixfrom</span><span class=\"p\">,</span> <span class=\"n\">linesep</span><span class=\"o\">=</span><span class=\"n\">linesep</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">fp</span><span class=\"o\">.</span><span class=\"n\">getvalue</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">as_bytes</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">unixfrom</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">linesep</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"se\">\\n</span><span class=\"s2\">&quot;</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Return the entire formatted message as bytes.</span>\n<span class=\"sd\">        Optional `unixfrom&#39; when True, means include the Unix From_ envelope</span>\n<span class=\"sd\">        header.</span>\n\n<span class=\"sd\">        This overrides the default as_bytes() implementation to not mangle</span>\n<span class=\"sd\">        lines that begin with &#39;From &#39;. See bug #13433 for details.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">fp</span> <span class=\"o\">=</span> <span class=\"n\">BytesIO</span><span class=\"p\">()</span>\n        <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">generator</span><span class=\"o\">.</span><span class=\"n\">BytesGenerator</span><span class=\"p\">(</span><span class=\"n\">fp</span><span class=\"p\">,</span> <span class=\"n\">mangle_from_</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">flatten</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">unixfrom</span><span class=\"o\">=</span><span class=\"n\">unixfrom</span><span class=\"p\">,</span> <span class=\"n\">linesep</span><span class=\"o\">=</span><span class=\"n\">linesep</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">fp</span><span class=\"o\">.</span><span class=\"n\">getvalue</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">SafeMIMEMessage</span><span class=\"p\">(</span><span class=\"n\">MIMEMixin</span><span class=\"p\">,</span> <span class=\"n\">MIMEMessage</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__setitem__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">):</span>\n        <span class=\"c1\"># message/rfc822 attachments must be ASCII</span>\n        <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"n\">forbid_multi_line_headers</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"s2\">&quot;ascii&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">MIMEMessage</span><span class=\"o\">.</span><span class=\"fm\">__setitem__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">SafeMIMEText</span><span class=\"p\">(</span><span class=\"n\">MIMEMixin</span><span class=\"p\">,</span> <span class=\"n\">MIMEText</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">_text</span><span class=\"p\">,</span> <span class=\"n\">_subtype</span><span class=\"o\">=</span><span class=\"s2\">&quot;plain&quot;</span><span class=\"p\">,</span> <span class=\"n\">_charset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"n\">_charset</span>\n        <span class=\"n\">MIMEText</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">_text</span><span class=\"p\">,</span> <span class=\"n\">_subtype</span><span class=\"o\">=</span><span class=\"n\">_subtype</span><span class=\"p\">,</span> <span class=\"n\">_charset</span><span class=\"o\">=</span><span class=\"n\">_charset</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__setitem__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">):</span>\n        <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"n\">forbid_multi_line_headers</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span><span class=\"p\">)</span>\n        <span class=\"n\">MIMEText</span><span class=\"o\">.</span><span class=\"fm\">__setitem__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">set_payload</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">payload</span><span class=\"p\">,</span> <span class=\"n\">charset</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">charset</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;utf-8&quot;</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">charset</span><span class=\"p\">,</span> <span class=\"n\">Charset</span><span class=\"o\">.</span><span class=\"n\">Charset</span><span class=\"p\">):</span>\n            <span class=\"n\">has_long_lines</span> <span class=\"o\">=</span> <span class=\"nb\">any</span><span class=\"p\">(</span>\n                <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">())</span> <span class=\"o\">&gt;</span> <span class=\"n\">RFC5322_EMAIL_LINE_LENGTH_LIMIT</span>\n                <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">payload</span><span class=\"o\">.</span><span class=\"n\">splitlines</span><span class=\"p\">()</span>\n            <span class=\"p\">)</span>\n            <span class=\"c1\"># Quoted-Printable encoding has the side effect of shortening long</span>\n            <span class=\"c1\"># lines, if any (#22561).</span>\n            <span class=\"n\">charset</span> <span class=\"o\">=</span> <span class=\"n\">utf8_charset_qp</span> <span class=\"k\">if</span> <span class=\"n\">has_long_lines</span> <span class=\"k\">else</span> <span class=\"n\">utf8_charset</span>\n        <span class=\"n\">MIMEText</span><span class=\"o\">.</span><span class=\"n\">set_payload</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">payload</span><span class=\"p\">,</span> <span class=\"n\">charset</span><span class=\"o\">=</span><span class=\"n\">charset</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">SafeMIMEMultipart</span><span class=\"p\">(</span><span class=\"n\">MIMEMixin</span><span class=\"p\">,</span> <span class=\"n\">MIMEMultipart</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">_subtype</span><span class=\"o\">=</span><span class=\"s2\">&quot;mixed&quot;</span><span class=\"p\">,</span> <span class=\"n\">boundary</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">_subparts</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">_params</span>\n    <span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"n\">encoding</span>\n        <span class=\"n\">MIMEMultipart</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">_subtype</span><span class=\"p\">,</span> <span class=\"n\">boundary</span><span class=\"p\">,</span> <span class=\"n\">_subparts</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">_params</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__setitem__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">):</span>\n        <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span> <span class=\"o\">=</span> <span class=\"n\">forbid_multi_line_headers</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span><span class=\"p\">)</span>\n        <span class=\"n\">MIMEMultipart</span><span class=\"o\">.</span><span class=\"fm\">__setitem__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">val</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"EmailMessage\"><a class=\"viewcode-back\" href=\"../../../../../topics/email/#django.core.mail.EmailMessage\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">EmailMessage</span><span class=\"p\">:</span>\n    <span class=\"sd\">&quot;&quot;&quot;A container for email information.&quot;&quot;&quot;</span>\n\n    <span class=\"n\">content_subtype</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;plain&quot;</span>\n    <span class=\"n\">mixed_subtype</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;mixed&quot;</span>\n    <span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>  <span class=\"c1\"># None =&gt; use settings default</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">body</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">from_email</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">to</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">bcc</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">connection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">attachments</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">cc</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">reply_to</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Initialize a single email message (which can be sent to multiple</span>\n<span class=\"sd\">        recipients).</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"n\">to</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">to</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span><span class=\"s1\">&#39;&quot;to&quot; argument must be a list or tuple&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">to</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">to</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">to</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">if</span> <span class=\"n\">cc</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">cc</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span><span class=\"s1\">&#39;&quot;cc&quot; argument must be a list or tuple&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cc</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">cc</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cc</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">if</span> <span class=\"n\">bcc</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">bcc</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span><span class=\"s1\">&#39;&quot;bcc&quot; argument must be a list or tuple&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">bcc</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">bcc</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">bcc</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">if</span> <span class=\"n\">reply_to</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">reply_to</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span><span class=\"s1\">&#39;&quot;reply_to&quot; argument must be a list or tuple&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">reply_to</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">reply_to</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">reply_to</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">from_email</span> <span class=\"o\">=</span> <span class=\"n\">from_email</span> <span class=\"ow\">or</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_FROM_EMAIL</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">subject</span> <span class=\"o\">=</span> <span class=\"n\">subject</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">body</span> <span class=\"o\">=</span> <span class=\"n\">body</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attachments</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">if</span> <span class=\"n\">attachments</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">attachment</span> <span class=\"ow\">in</span> <span class=\"n\">attachments</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">attachment</span><span class=\"p\">,</span> <span class=\"n\">MIMEBase</span><span class=\"p\">):</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"n\">attachment</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">attachment</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">extra_headers</span> <span class=\"o\">=</span> <span class=\"n\">headers</span> <span class=\"ow\">or</span> <span class=\"p\">{}</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">connection</span> <span class=\"o\">=</span> <span class=\"n\">connection</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_connection</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fail_silently</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.core.mail</span> <span class=\"kn\">import</span> <span class=\"n\">get_connection</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">connection</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">connection</span> <span class=\"o\">=</span> <span class=\"n\">get_connection</span><span class=\"p\">(</span><span class=\"n\">fail_silently</span><span class=\"o\">=</span><span class=\"n\">fail_silently</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">connection</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span> <span class=\"ow\">or</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_CHARSET</span>\n        <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">SafeMIMEText</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">content_subtype</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">)</span>\n        <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_message</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">)</span>\n        <span class=\"n\">msg</span><span class=\"p\">[</span><span class=\"s2\">&quot;Subject&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">subject</span>\n        <span class=\"n\">msg</span><span class=\"p\">[</span><span class=\"s2\">&quot;From&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">extra_headers</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;From&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">from_email</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_list_header_if_not_empty</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"s2\">&quot;To&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_list_header_if_not_empty</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Cc&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cc</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_list_header_if_not_empty</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"s2\">&quot;Reply-To&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">reply_to</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Email header names are case-insensitive (RFC 2045), so we have to</span>\n        <span class=\"c1\"># accommodate that when doing comparisons.</span>\n        <span class=\"n\">header_names</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">key</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">key</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">extra_headers</span><span class=\"p\">]</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;date&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">header_names</span><span class=\"p\">:</span>\n            <span class=\"c1\"># formatdate() uses stdlib methods to format the date, which use</span>\n            <span class=\"c1\"># the stdlib/OS concept of a timezone, however, Django sets the</span>\n            <span class=\"c1\"># TZ environment variable based on the TIME_ZONE setting which</span>\n            <span class=\"c1\"># will get picked up by formatdate().</span>\n            <span class=\"n\">msg</span><span class=\"p\">[</span><span class=\"s2\">&quot;Date&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">formatdate</span><span class=\"p\">(</span><span class=\"n\">localtime</span><span class=\"o\">=</span><span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">EMAIL_USE_LOCALTIME</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;message-id&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">header_names</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Use cached DNS_NAME for performance</span>\n            <span class=\"n\">msg</span><span class=\"p\">[</span><span class=\"s2\">&quot;Message-ID&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">make_msgid</span><span class=\"p\">(</span><span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"n\">DNS_NAME</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">extra_headers</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"k\">if</span> <span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span> <span class=\"o\">!=</span> <span class=\"s2\">&quot;from&quot;</span><span class=\"p\">:</span>  <span class=\"c1\"># From is already handled</span>\n                <span class=\"n\">msg</span><span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n        <span class=\"k\">return</span> <span class=\"n\">msg</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">recipients</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a list of all recipients of the email (includes direct</span>\n<span class=\"sd\">        addressees as well as Cc and Bcc entries).</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">email</span> <span class=\"k\">for</span> <span class=\"n\">email</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">to</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cc</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">bcc</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">email</span><span class=\"p\">]</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">send</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">fail_silently</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Send the email message.&quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">recipients</span><span class=\"p\">():</span>\n            <span class=\"c1\"># Don&#39;t bother creating the network connection if there&#39;s nobody to</span>\n            <span class=\"c1\"># send to.</span>\n            <span class=\"k\">return</span> <span class=\"mi\">0</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_connection</span><span class=\"p\">(</span><span class=\"n\">fail_silently</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">send_messages</span><span class=\"p\">([</span><span class=\"bp\">self</span><span class=\"p\">])</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">attach</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">filename</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Attach a file with the given filename and content. The filename can</span>\n<span class=\"sd\">        be omitted and the mimetype is guessed, if not provided.</span>\n\n<span class=\"sd\">        If the first parameter is a MIMEBase subclass, insert it directly</span>\n<span class=\"sd\">        into the resulting message attachments.</span>\n\n<span class=\"sd\">        For a text/* mimetype (guessed or specified), when a bytes object is</span>\n<span class=\"sd\">        specified as content, decode it as UTF-8. If that fails, set the</span>\n<span class=\"sd\">        mimetype to DEFAULT_ATTACHMENT_MIME_TYPE and don&#39;t decode the content.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">,</span> <span class=\"n\">MIMEBase</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">content</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">mimetype</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;content and mimetype must not be given when a MIMEBase &quot;</span>\n                    <span class=\"s2\">&quot;instance is provided.&quot;</span>\n                <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attachments</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"n\">content</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">&quot;content must be provided.&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">mimetype</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                <span class=\"n\">mimetype</span>\n                <span class=\"ow\">or</span> <span class=\"n\">mimetypes</span><span class=\"o\">.</span><span class=\"n\">guess_type</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n                <span class=\"ow\">or</span> <span class=\"n\">DEFAULT_ATTACHMENT_MIME_TYPE</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">basetype</span><span class=\"p\">,</span> <span class=\"n\">subtype</span> <span class=\"o\">=</span> <span class=\"n\">mimetype</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s2\">&quot;/&quot;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">basetype</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;text&quot;</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"nb\">bytes</span><span class=\"p\">):</span>\n                    <span class=\"k\">try</span><span class=\"p\">:</span>\n                        <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">content</span><span class=\"o\">.</span><span class=\"n\">decode</span><span class=\"p\">()</span>\n                    <span class=\"k\">except</span> <span class=\"ne\">UnicodeDecodeError</span><span class=\"p\">:</span>\n                        <span class=\"c1\"># If mimetype suggests the file is text but it&#39;s</span>\n                        <span class=\"c1\"># actually binary, read() raises a UnicodeDecodeError.</span>\n                        <span class=\"n\">mimetype</span> <span class=\"o\">=</span> <span class=\"n\">DEFAULT_ATTACHMENT_MIME_TYPE</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attachments</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">((</span><span class=\"n\">filename</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">attach_file</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Attach a file from the filesystem.</span>\n\n<span class=\"sd\">        Set the mimetype to DEFAULT_ATTACHMENT_MIME_TYPE if it isn&#39;t specified</span>\n<span class=\"sd\">        and cannot be guessed.</span>\n\n<span class=\"sd\">        For a text/* mimetype (guessed or specified), decode the file&#39;s content</span>\n<span class=\"sd\">        as UTF-8. If that fails, set the mimetype to</span>\n<span class=\"sd\">        DEFAULT_ATTACHMENT_MIME_TYPE and don&#39;t decode the content.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">Path</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n        <span class=\"k\">with</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"s2\">&quot;rb&quot;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">file</span><span class=\"p\">:</span>\n            <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">file</span><span class=\"o\">.</span><span class=\"n\">read</span><span class=\"p\">()</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_create_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_attachments</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_create_attachments</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attachments</span><span class=\"p\">:</span>\n            <span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span> <span class=\"ow\">or</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_CHARSET</span>\n            <span class=\"n\">body_msg</span> <span class=\"o\">=</span> <span class=\"n\">msg</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">SafeMIMEMultipart</span><span class=\"p\">(</span><span class=\"n\">_subtype</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mixed_subtype</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"n\">encoding</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">body</span> <span class=\"ow\">or</span> <span class=\"n\">body_msg</span><span class=\"o\">.</span><span class=\"n\">is_multipart</span><span class=\"p\">():</span>\n                <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"n\">body_msg</span><span class=\"p\">)</span>\n            <span class=\"k\">for</span> <span class=\"n\">attachment</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">attachments</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">attachment</span><span class=\"p\">,</span> <span class=\"n\">MIMEBase</span><span class=\"p\">):</span>\n                    <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"n\">attachment</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_attachment</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">attachment</span><span class=\"p\">))</span>\n        <span class=\"k\">return</span> <span class=\"n\">msg</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_create_mime_attachment</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Convert the content, mimetype pair into a MIME attachment object.</span>\n\n<span class=\"sd\">        If the mimetype is message/rfc822, content may be an</span>\n<span class=\"sd\">        email.Message or EmailMessage object, as well as a str.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">basetype</span><span class=\"p\">,</span> <span class=\"n\">subtype</span> <span class=\"o\">=</span> <span class=\"n\">mimetype</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s2\">&quot;/&quot;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">basetype</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;text&quot;</span><span class=\"p\">:</span>\n            <span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span> <span class=\"ow\">or</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_CHARSET</span>\n            <span class=\"n\">attachment</span> <span class=\"o\">=</span> <span class=\"n\">SafeMIMEText</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">subtype</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"n\">basetype</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;message&quot;</span> <span class=\"ow\">and</span> <span class=\"n\">subtype</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;rfc822&quot;</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Bug #18967: Per RFC 2046 Section 5.2.1, message/rfc822</span>\n            <span class=\"c1\"># attachments must not be base64 encoded.</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">EmailMessage</span><span class=\"p\">):</span>\n                <span class=\"c1\"># convert content into an email.Message first</span>\n                <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">content</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">()</span>\n            <span class=\"k\">elif</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">Message</span><span class=\"p\">):</span>\n                <span class=\"c1\"># For compatibility with existing code, parse the message</span>\n                <span class=\"c1\"># into an email.Message object if it is not one already.</span>\n                <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">message_from_string</span><span class=\"p\">(</span><span class=\"n\">force_str</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">))</span>\n\n            <span class=\"n\">attachment</span> <span class=\"o\">=</span> <span class=\"n\">SafeMIMEMessage</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">subtype</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Encode non-text attachments with base64.</span>\n            <span class=\"n\">attachment</span> <span class=\"o\">=</span> <span class=\"n\">MIMEBase</span><span class=\"p\">(</span><span class=\"n\">basetype</span><span class=\"p\">,</span> <span class=\"n\">subtype</span><span class=\"p\">)</span>\n            <span class=\"n\">attachment</span><span class=\"o\">.</span><span class=\"n\">set_payload</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">)</span>\n            <span class=\"n\">Encoders</span><span class=\"o\">.</span><span class=\"n\">encode_base64</span><span class=\"p\">(</span><span class=\"n\">attachment</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">attachment</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_create_attachment</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">filename</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Convert the filename, content, mimetype triple into a MIME attachment</span>\n<span class=\"sd\">        object.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">attachment</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_mime_attachment</span><span class=\"p\">(</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">filename</span><span class=\"p\">:</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">filename</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s2\">&quot;ascii&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"ne\">UnicodeEncodeError</span><span class=\"p\">:</span>\n                <span class=\"n\">filename</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s2\">&quot;utf-8&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">filename</span><span class=\"p\">)</span>\n            <span class=\"n\">attachment</span><span class=\"o\">.</span><span class=\"n\">add_header</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Content-Disposition&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;attachment&quot;</span><span class=\"p\">,</span> <span class=\"n\">filename</span><span class=\"o\">=</span><span class=\"n\">filename</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">attachment</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_set_list_header_if_not_empty</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">header</span><span class=\"p\">,</span> <span class=\"n\">values</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Set msg&#39;s header, either from self.extra_headers, if present, or from</span>\n<span class=\"sd\">        the values argument.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"n\">values</span><span class=\"p\">:</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">extra_headers</span><span class=\"p\">[</span><span class=\"n\">header</span><span class=\"p\">]</span>\n            <span class=\"k\">except</span> <span class=\"ne\">KeyError</span><span class=\"p\">:</span>\n                <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"n\">values</span><span class=\"p\">)</span>\n            <span class=\"n\">msg</span><span class=\"p\">[</span><span class=\"n\">header</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">value</span></div>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">EmailMultiAlternatives</span><span class=\"p\">(</span><span class=\"n\">EmailMessage</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    A version of EmailMessage that makes it easy to send multipart/alternative</span>\n<span class=\"sd\">    messages. For example, including text and HTML versions of the text is</span>\n<span class=\"sd\">    made easier.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"n\">alternative_subtype</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;alternative&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">body</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span>\n        <span class=\"n\">from_email</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">to</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">bcc</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">connection</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">attachments</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">alternatives</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">cc</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">reply_to</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Initialize a single email message (which can be sent to multiple</span>\n<span class=\"sd\">        recipients).</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span>\n            <span class=\"n\">subject</span><span class=\"p\">,</span>\n            <span class=\"n\">body</span><span class=\"p\">,</span>\n            <span class=\"n\">from_email</span><span class=\"p\">,</span>\n            <span class=\"n\">to</span><span class=\"p\">,</span>\n            <span class=\"n\">bcc</span><span class=\"p\">,</span>\n            <span class=\"n\">connection</span><span class=\"p\">,</span>\n            <span class=\"n\">attachments</span><span class=\"p\">,</span>\n            <span class=\"n\">headers</span><span class=\"p\">,</span>\n            <span class=\"n\">cc</span><span class=\"p\">,</span>\n            <span class=\"n\">reply_to</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">alternatives</span> <span class=\"o\">=</span> <span class=\"n\">alternatives</span> <span class=\"ow\">or</span> <span class=\"p\">[]</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">attach_alternative</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Attach an alternative content representation.&quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"n\">content</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">mimetype</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">&quot;Both content and mimetype must be provided.&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">alternatives</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">((</span><span class=\"n\">content</span><span class=\"p\">,</span> <span class=\"n\">mimetype</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_create_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_attachments</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_alternatives</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_create_alternatives</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">):</span>\n        <span class=\"n\">encoding</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">encoding</span> <span class=\"ow\">or</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_CHARSET</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">alternatives</span><span class=\"p\">:</span>\n            <span class=\"n\">body_msg</span> <span class=\"o\">=</span> <span class=\"n\">msg</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">SafeMIMEMultipart</span><span class=\"p\">(</span>\n                <span class=\"n\">_subtype</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">alternative_subtype</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"n\">encoding</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">body</span><span class=\"p\">:</span>\n                <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"n\">body_msg</span><span class=\"p\">)</span>\n            <span class=\"k\">for</span> <span class=\"n\">alternative</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">alternatives</span><span class=\"p\">:</span>\n                <span class=\"n\">msg</span><span class=\"o\">.</span><span class=\"n\">attach</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_mime_attachment</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">alternative</span><span class=\"p\">))</span>\n        <span class=\"k\">return</span> <span class=\"n\">msg</span>\n</pre></div>", "current_page_name": "_modules/django/core/mail/message", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}